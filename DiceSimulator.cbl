IDENTIFICATION DIVISION.
PROGRAM-ID. DND-DICE-PVP.

DATA DIVISION.
WORKING-STORAGE SECTION.

01 GAME-RUNNING         PIC 9 VALUE 1.
01 CURRENT-TURN         PIC 9 VALUE 1.
01 ROUND-NUMBER         PIC 99 VALUE 1.

01 PLAYER-NAME          PIC X(20) VALUE SPACES.
01 PLAYER-CLASS         PIC 9 VALUE 0.
01 PLAYER-SUBCLASS      PIC 9 VALUE 0.
01 PLAYER-HP            PIC 999 VALUE 100.
01 PLAYER-MAX-HP        PIC 999 VALUE 100.
01 PLAYER-ATTACK        PIC 99 VALUE 5.
01 PLAYER-AC            PIC 99 VALUE 15.
01 PLAYER-DAMAGE        PIC 99 VALUE 8.
01 PLAYER-SPECIAL       PIC 9 VALUE 3.

01 COMPUTER-NAME        PIC X(20) VALUE SPACES.
01 COMPUTER-CLASS       PIC 9 VALUE 0.
01 COMPUTER-SUBCLASS    PIC 9 VALUE 0.
01 COMPUTER-HP          PIC 999 VALUE 100.
01 COMPUTER-MAX-HP      PIC 999 VALUE 100.
01 COMPUTER-ATTACK      PIC 99 VALUE 5.
01 COMPUTER-AC          PIC 99 VALUE 15.
01 COMPUTER-DAMAGE      PIC 99 VALUE 8.
01 COMPUTER-SPECIAL     PIC 9 VALUE 3.

01 DICE-ROLL            PIC 99 VALUE 0.
01 DAMAGE-TOTAL         PIC 999 VALUE 0.
01 TEMP-NUM             PIC 999 VALUE 0.
01 CHOICE               PIC 9 VALUE 0.
01 INPUT-STRING         PIC X(30) VALUE SPACES.

01 CLASS-NAMES.
   05 FILLER            PIC X(15) VALUE "Fighter".
   05 FILLER            PIC X(15) VALUE "Paladin".
   05 FILLER            PIC X(15) VALUE "Wizard".

01 CLASS-TABLE REDEFINES CLASS-NAMES.
   05 CLASS-ENTRY OCCURS 3 TIMES PIC X(15).

01 SUBCLASS-NAMES.
   05 FILLER            PIC X(15) VALUE "Champion".
   05 FILLER            PIC X(15) VALUE "Battle Master".
   05 FILLER            PIC X(15) VALUE "Devotion".
   05 FILLER            PIC X(15) VALUE "Vengeance".
   05 FILLER            PIC X(15) VALUE "Evocation".
   05 FILLER            PIC X(15) VALUE "Necromancy".

01 SUBCLASS-TABLE REDEFINES SUBCLASS-NAMES.
   05 SUBCLASS-ENTRY OCCURS 6 TIMES PIC X(15).

PROCEDURE DIVISION.
MAIN-PROCEDURE.
    PERFORM INITIALIZE-GAME
    PERFORM DISPLAY-TITLE
    PERFORM SETUP-PLAYER-CHARACTER
    PERFORM SETUP-COMPUTER-CHARACTER
    PERFORM GAME-LOOP UNTIL GAME-RUNNING = 0
    PERFORM END-GAME
    STOP RUN.

INITIALIZE-GAME.
    DISPLAY "==========================================="
    DISPLAY "    D&D DICE PVP COMBAT SIMULATOR"
    DISPLAY "==========================================="
    DISPLAY " ".

DISPLAY-TITLE.
    DISPLAY "Welcome to the arena, brave warrior!"
    DISPLAY "Prepare for dice-based combat!"
    DISPLAY " ".

SETUP-PLAYER-CHARACTER.
    DISPLAY "=== CHARACTER CREATION ==="
    DISPLAY " "
    DISPLAY "Enter your character name: "
    ACCEPT PLAYER-NAME
    
    DISPLAY " "
    DISPLAY "Choose your class:"
    DISPLAY "1. Fighter - Masters of martial combat"
    DISPLAY "2. Paladin - Holy warriors with divine magic"
    DISPLAY "3. Wizard - Arcane spellcasters"
    DISPLAY "Enter choice (1-3): "
    ACCEPT PLAYER-CLASS
    
    IF PLAYER-CLASS = 1
        PERFORM SETUP-FIGHTER-SUBCLASS
    ELSE IF PLAYER-CLASS = 2
        PERFORM SETUP-PALADIN-SUBCLASS
    ELSE IF PLAYER-CLASS = 3
        PERFORM SETUP-WIZARD-SUBCLASS
    ELSE
        MOVE 1 TO PLAYER-CLASS
        PERFORM SETUP-FIGHTER-SUBCLASS
    END-IF
    
    PERFORM APPLY-PLAYER-STATS.

SETUP-FIGHTER-SUBCLASS.
    DISPLAY " "
    DISPLAY "Choose Fighter subclass:"
    DISPLAY "1. Champion - Enhanced critical hits"
    DISPLAY "2. Battle Master - Tactical maneuvers"
    DISPLAY "Enter choice (1-2): "
    ACCEPT PLAYER-SUBCLASS
    
    IF PLAYER-SUBCLASS NOT = 1 AND PLAYER-SUBCLASS NOT = 2
        MOVE 1 TO PLAYER-SUBCLASS
    END-IF.

SETUP-PALADIN-SUBCLASS.
    DISPLAY " "
    DISPLAY "Choose Paladin subclass:"
    DISPLAY "1. Devotion - Sacred oath of protection"
    DISPLAY "2. Vengeance - Oath of retribution"
    DISPLAY "Enter choice (1-2): "
    ACCEPT CHOICE
    
    IF CHOICE = 1
        MOVE 3 TO PLAYER-SUBCLASS
    ELSE
        MOVE 4 TO PLAYER-SUBCLASS
    END-IF.

SETUP-WIZARD-SUBCLASS.
    DISPLAY " "
    DISPLAY "Choose Wizard subclass:"
    DISPLAY "1. Evocation - Destructive magic"
    DISPLAY "2. Necromancy - Death magic"
    DISPLAY "Enter choice (1-2): "
    ACCEPT CHOICE
    
    IF CHOICE = 1
        MOVE 5 TO PLAYER-SUBCLASS
    ELSE
        MOVE 6 TO PLAYER-SUBCLASS
    END-IF.

APPLY-PLAYER-STATS.
    IF PLAYER-CLASS = 1
        MOVE 120 TO PLAYER-HP
        MOVE 120 TO PLAYER-MAX-HP
        MOVE 7 TO PLAYER-ATTACK
        MOVE 18 TO PLAYER-AC
        MOVE 10 TO PLAYER-DAMAGE
    ELSE IF PLAYER-CLASS = 2
        MOVE 110 TO PLAYER-HP
        MOVE 110 TO PLAYER-MAX-HP
        MOVE 6 TO PLAYER-ATTACK
        MOVE 19 TO PLAYER-AC
        MOVE 8 TO PLAYER-DAMAGE
    ELSE IF PLAYER-CLASS = 3
        MOVE 80 TO PLAYER-HP
        MOVE 80 TO PLAYER-MAX-HP
        MOVE 4 TO PLAYER-ATTACK
        MOVE 13 TO PLAYER-AC
        MOVE 12 TO PLAYER-DAMAGE
    END-IF.

SETUP-COMPUTER-CHARACTER.
    PERFORM ROLL-DICE
    COMPUTE COMPUTER-CLASS = FUNCTION MOD(DICE-ROLL, 3) + 1
    
    PERFORM ROLL-DICE
    COMPUTE COMPUTER-SUBCLASS = FUNCTION MOD(DICE-ROLL, 2) + 1
    
    IF COMPUTER-CLASS = 1
        MOVE "Iron Fist" TO COMPUTER-NAME
        IF COMPUTER-SUBCLASS = 2
            MOVE 2 TO COMPUTER-SUBCLASS
        END-IF
    ELSE IF COMPUTER-CLASS = 2
        MOVE "Sir Blackheart" TO COMPUTER-NAME
        IF COMPUTER-SUBCLASS = 1
            MOVE 3 TO COMPUTER-SUBCLASS
        ELSE
            MOVE 4 TO COMPUTER-SUBCLASS
        END-IF
    ELSE IF COMPUTER-CLASS = 3
        MOVE "Shadowmage" TO COMPUTER-NAME
        IF COMPUTER-SUBCLASS = 1
            MOVE 5 TO COMPUTER-SUBCLASS
        ELSE
            MOVE 6 TO COMPUTER-SUBCLASS
        END-IF
    END-IF
    
    PERFORM APPLY-COMPUTER-STATS.

APPLY-COMPUTER-STATS.
    IF COMPUTER-CLASS = 1
        MOVE 120 TO COMPUTER-HP
        MOVE 120 TO COMPUTER-MAX-HP
        MOVE 7 TO COMPUTER-ATTACK
        MOVE 18 TO COMPUTER-AC
        MOVE 10 TO COMPUTER-DAMAGE
    ELSE IF COMPUTER-CLASS = 2
        MOVE 110 TO COMPUTER-HP
        MOVE 110 TO COMPUTER-MAX-HP
        MOVE 6 TO COMPUTER-ATTACK
        MOVE 19 TO COMPUTER-AC
        MOVE 8 TO COMPUTER-DAMAGE
    ELSE IF COMPUTER-CLASS = 3
        MOVE 80 TO COMPUTER-HP
        MOVE 80 TO COMPUTER-MAX-HP
        MOVE 4 TO COMPUTER-ATTACK
        MOVE 13 TO COMPUTER-AC
        MOVE 12 TO COMPUTER-DAMAGE
    END-IF.

GAME-LOOP.
    PERFORM DISPLAY-COMBAT-STATUS
    
    IF CURRENT-TURN = 1
        PERFORM PLAYER-TURN
        MOVE 2 TO CURRENT-TURN
    ELSE
        PERFORM COMPUTER-TURN
        MOVE 1 TO CURRENT-TURN
        ADD 1 TO ROUND-NUMBER
    END-IF
    
    PERFORM CHECK-GAME-END.

DISPLAY-COMBAT-STATUS.
    DISPLAY " "
    DISPLAY "========== ROUND " ROUND-NUMBER " =========="
    DISPLAY PLAYER-NAME " (" CLASS-ENTRY(PLAYER-CLASS) "): " 
            PLAYER-HP "/" PLAYER-MAX-HP " HP"
    DISPLAY COMPUTER-NAME " (" CLASS-ENTRY(COMPUTER-CLASS) "): " 
            COMPUTER-HP "/" COMPUTER-MAX-HP " HP"
    DISPLAY " ".

PLAYER-TURN.
    DISPLAY "--- " PLAYER-NAME "'s Turn ---"
    DISPLAY "1. Attack"
    DISPLAY "2. Special Ability (" PLAYER-SPECIAL " uses left)"
    DISPLAY "3. Defend (+2 AC this round)"
    DISPLAY "Choose action: "
    ACCEPT CHOICE
    
    IF CHOICE = 1
        PERFORM PLAYER-ATTACK-ACTION
    ELSE IF CHOICE = 2
        IF PLAYER-SPECIAL > 0
            PERFORM PLAYER-SPECIAL-ABILITY
            SUBTRACT 1 FROM PLAYER-SPECIAL
        ELSE
            DISPLAY "No special abilities left! Attacking instead."
            PERFORM PLAYER-ATTACK-ACTION
        END-IF
    ELSE IF CHOICE = 3
        PERFORM PLAYER-DEFEND
    ELSE
        PERFORM PLAYER-ATTACK-ACTION
    END-IF.

PLAYER-ATTACK-ACTION.
    DISPLAY PLAYER-NAME " attacks with their weapon!"
    PERFORM ROLL-DICE
    COMPUTE TEMP-NUM = DICE-ROLL + PLAYER-ATTACK
    DISPLAY "Attack roll: " DICE-ROLL " + " PLAYER-ATTACK 
            " = " TEMP-NUM
    
    IF TEMP-NUM >= COMPUTER-AC
        PERFORM ROLL-DAMAGE
        DISPLAY "Hit! Damage: " DAMAGE-TOTAL
        SUBTRACT DAMAGE-TOTAL FROM COMPUTER-HP
        IF COMPUTER-HP < 0
            MOVE 0 TO COMPUTER-HP
        END-IF
    ELSE
        DISPLAY "Miss! The attack fails to penetrate armor."
    END-IF.

PLAYER-SPECIAL-ABILITY.
    IF PLAYER-SUBCLASS = 1
        PERFORM PLAYER-CHAMPION-SPECIAL
    ELSE IF PLAYER-SUBCLASS = 2
        PERFORM PLAYER-BATTLE-MASTER-SPECIAL
    ELSE IF PLAYER-SUBCLASS = 3
        PERFORM PLAYER-DEVOTION-SPECIAL
    ELSE IF PLAYER-SUBCLASS = 4
        PERFORM PLAYER-VENGEANCE-SPECIAL
    ELSE IF PLAYER-SUBCLASS = 5
        PERFORM PLAYER-EVOCATION-SPECIAL
    ELSE IF PLAYER-SUBCLASS = 6
        PERFORM PLAYER-NECROMANCY-SPECIAL
    END-IF.

PLAYER-CHAMPION-SPECIAL.
    DISPLAY PLAYER-NAME " enters a fighting stance! Critical hits on 19-20!"
    PERFORM ROLL-DICE
    COMPUTE TEMP-NUM = DICE-ROLL + PLAYER-ATTACK
    DISPLAY "Enhanced attack roll: " DICE-ROLL " + " PLAYER-ATTACK 
            " = " TEMP-NUM
    
    IF TEMP-NUM >= COMPUTER-AC
        IF DICE-ROLL >= 19
            DISPLAY "CRITICAL HIT!"
            PERFORM ROLL-DAMAGE
            MULTIPLY DAMAGE-TOTAL BY 2
        ELSE
            PERFORM ROLL-DAMAGE
        END-IF
        DISPLAY "Damage: " DAMAGE-TOTAL
        SUBTRACT DAMAGE-TOTAL FROM COMPUTER-HP
        IF COMPUTER-HP < 0
            MOVE 0 TO COMPUTER-HP
        END-IF
    ELSE
        DISPLAY "Miss!"
    END- BATTLE-MASTER-SPECIAL.
    DISPLAY PLAYER-NAME " uses a tactical maneuver!"
    PERFORM ROLL-DICE
    COMPUTE TEMP-NUM = DICE-ROLL + PLAYER-ATTACK + 2
    DISPLAY "Tactical attack: " DICE-ROLL " + " PLAYER-ATTACK 
            " + 2 = " TEMP-NUM
    
    IF TEMP-NUM >= COMPUTER-AC
        PERFORM ROLL-DAMAGE
        ADD 4 TO DAMAGE-TOTAL
        DISPLAY "Hit with superior technique! Damage: " DAMAGE-TOTAL
        SUBTRACT DAMAGE-TOTAL FROM COMPUTER-HP
        IF COMPUTER-HP < 0
            MOVE 0 TO COMPUTER-HP
        END-IF
    ELSE
        DISPLAY "The maneuver fails!"
    END-IF.

PLAYER-DEVOTION-SPECIAL.
    DISPLAY PLAYER-NAME " channels divine energy!"
    PERFORM ROLL-DICE
    COMPUTE DAMAGE-TOTAL = FUNCTION MOD(DICE-ROLL, 8) + 1
    ADD DAMAGE-TOTAL TO PLAYER-HP
    IF PLAYER-HP > PLAYER-MAX-HP
        MOVE PLAYER-MAX-HP TO PLAYER-HP
    END-IF
    DISPLAY "Healing: " DAMAGE-TOTAL " HP restored.".

PLAYER-VENGEANCE-SPECIAL.
    DISPLAY PLAYER-NAME " marks their enemy for divine vengeance!"
    PERFORM ROLL-DICE
    COMPUTE TEMP-NUM = DICE-ROLL + PLAYER-ATTACK + 3
    DISPLAY "Vengeance strike: " DICE-ROLL " + " PLAYER-ATTACK 
            " + 3 = " TEMP-NUM
    
    IF TEMP-NUM >= COMPUTER-AC
        PERFORM ROLL-DAMAGE
        PERFORM ROLL-DICE
        COMPUTE TEMP-NUM = FUNCTION MOD(DICE-ROLL, 6) + 1
        ADD TEMP-NUM TO DAMAGE-TOTAL
        DISPLAY "Divine wrath! Damage: " DAMAGE-TOTAL
        SUBTRACT DAMAGE-TOTAL FROM COMPUTER-HP
        IF COMPUTER-HP < 0
            MOVE 0 TO COMPUTER-HP
        END-IF
    ELSE
        DISPLAY "The divine strike misses!"
    END-IF.

PLAYER-EVOCATION-SPECIAL.
    DISPLAY PLAYER-NAME " casts Magic Missile!"
    MOVE 0 TO DAMAGE-TOTAL
    PERFORM 3 TIMES
        PERFORM ROLL-DICE
        COMPUTE TEMP-NUM = FUNCTION MOD(DICE-ROLL, 4) + 1
        ADD TEMP-NUM TO DAMAGE-TOTAL
    END-PERFORM
    ADD 3 TO DAMAGE-TOTAL
    DISPLAY "Magical force strikes! Damage: " DAMAGE-TOTAL
    SUBTRACT DAMAGE-TOTAL FROM COMPUTER-HP
    IF COMPUTER-HP < 0
        MOVE 0 TO COMPUTER-HP
    END-IF.

PLAYER-NECROMANCY-SPECIAL.
    DISPLAY PLAYER-NAME " drains life force!"
    PERFORM ROLL-DICE
    COMPUTE DAMAGE-TOTAL = FUNCTION MOD(DICE-ROLL, 10) + 1
    DISPLAY "Necrotic damage: " DAMAGE-TOTAL
    SUBTRACT DAMAGE-TOTAL FROM COMPUTER-HP
    COMPUTE TEMP-NUM = DAMAGE-TOTAL / 2
    ADD TEMP-NUM TO PLAYER-HP
    IF PLAYER-HP > PLAYER-MAX-HP
        MOVE PLAYER-MAX-HP TO PLAYER-HP
    END-IF
    DISPLAY "Life drained! " TEMP-NUM " HP recovered."
    IF COMPUTER-HP < 0
        MOVE 0 TO COMPUTER-HP
    END-IF.

PLAYER-DEFEND.
    DISPLAY PLAYER-NAME " takes a defensive stance!"
    ADD 2 TO PLAYER-AC
    DISPLAY "Armor Class increased to " PLAYER-AC " for this round.".

COMPUTER-TURN.
    DISPLAY "--- " COMPUTER-NAME "'s Turn ---"
    PERFORM ROLL-DICE
    COMPUTE CHOICE = FUNCTION MOD(DICE-ROLL, 10) + 1
    
    IF CHOICE <= 6
        PERFORM COMPUTER-ATTACK-ACTION
    ELSE
        IF COMPUTER-SPECIAL > 0
            PERFORM COMPUTER-SPECIAL-ABILITY
            SUBTRACT 1 FROM COMPUTER-SPECIAL
        ELSE
            PERFORM COMPUTER-ATTACK-ACTION
        END-IF
    END-IF
    
    IF PLAYER-AC > 19 AND PLAYER-CLASS NOT = 2
        SUBTRACT 2 FROM PLAYER-AC
    END-IF
    IF PLAYER-AC > 21 AND PLAYER-CLASS = 2
        SUBTRACT 2 FROM PLAYER-AC
    END-IF.

COMPUTER-ATTACK-ACTION.
    DISPLAY COMPUTER-NAME " attacks!"
    PERFORM ROLL-DICE
    COMPUTE TEMP-NUM = DICE-ROLL + COMPUTER-ATTACK
    DISPLAY "Attack roll: " DICE-ROLL " + " COMPUTER-ATTACK 
            " = " TEMP-NUM
    
    IF TEMP-NUM >= PLAYER-AC
        PERFORM ROLL-COMPUTER-DAMAGE
        DISPLAY "Hit! Damage: " DAMAGE-TOTAL
        SUBTRACT DAMAGE-TOTAL FROM PLAYER-HP
        IF PLAYER-HP < 0
            MOVE 0 TO PLAYER-HP
        END-IF
    ELSE
        DISPLAY "Miss!"
    END-IF.

COMPUTER-SPECIAL-ABILITY.
    DISPLAY COMPUTER-NAME " uses a special ability!"
    IF COMPUTER-SUBCLASS = 1
        PERFORM COMPUTER-CHAMPION-SPECIAL
    ELSE IF COMPUTER-SUBCLASS = 2
        PERFORM COMPUTER-BATTLE-MASTER-SPECIAL
    ELSE IF COMPUTER-SUBCLASS = 3
        PERFORM COMPUTER-DEVOTION-SPECIAL
    ELSE IF COMPUTER-SUBCLASS = 4
        PERFORM COMPUTER-VENGEANCE-SPECIAL
    ELSE IF COMPUTER-SUBCLASS = 5
        PERFORM COMPUTER-EVOCATION-SPECIAL
    ELSE IF COMPUTER-SUBCLASS = 6
        PERFORM COMPUTER-NECROMANCY-SPECIAL
    END-IF.

COMPUTER-CHAMPION-SPECIAL.
    PERFORM ROLL-DICE
    COMPUTE TEMP-NUM = DICE-ROLL + COMPUTER-ATTACK
    
    IF TEMP-NUM >= PLAYER-AC
        IF DICE-ROLL >= 19
            PERFORM ROLL-COMPUTER-DAMAGE
            MULTIPLY DAMAGE-TOTAL BY 2
            DISPLAY "Critical hit! Damage: " DAMAGE-TOTAL
        ELSE
            PERFORM ROLL-COMPUTER-DAMAGE
            DISPLAY "Enhanced attack! Damage: " DAMAGE-TOTAL
        END-IF
        SUBTRACT DAMAGE-TOTAL FROM PLAYER-HP
        IF PLAYER-HP < 0
            MOVE 0 TO PLAYER-HP
        END-IF
    ELSE
        DISPLAY "The enhanced attack misses!"
    END-IF.

COMPUTER-BATTLE-MASTER-SPECIAL.
    PERFORM ROLL-DICE
    COMPUTE TEMP-NUM = DICE-ROLL + COMPUTER-ATTACK + 2
    
    IF TEMP-NUM >= PLAYER-AC
        PERFORM ROLL-COMPUTER-DAMAGE
        ADD 4 TO DAMAGE-TOTAL
        DISPLAY "Tactical strike! Damage: " DAMAGE-TOTAL
        SUBTRACT DAMAGE-TOTAL FROM PLAYER-HP
        IF PLAYER-HP < 0
            MOVE 0 TO PLAYER-HP
        END-IF
    ELSE
        DISPLAY "The tactical maneuver fails!"
    END-IF.

COMPUTER-DEVOTION-SPECIAL.
    PERFORM ROLL-DICE
    COMPUTE DAMAGE-TOTAL = FUNCTION MOD(DICE-ROLL, 8) + 1
    ADD DAMAGE-TOTAL TO COMPUTER-HP
    IF COMPUTER-HP > COMPUTER-MAX-HP
        MOVE COMPUTER-MAX-HP TO COMPUTER-HP
    END-IF
    DISPLAY "Divine healing! " DAMAGE-TOTAL " HP restored.".

COMPUTER-VENGEANCE-SPECIAL.
    PERFORM ROLL-DICE
    COMPUTE TEMP-NUM = DICE-ROLL + COMPUTER-ATTACK + 3
    
    IF TEMP-NUM >= PLAYER-AC
        PERFORM ROLL-COMPUTER-DAMAGE
        PERFORM ROLL-DICE
        COMPUTE TEMP-NUM = FUNCTION MOD(DICE-ROLL, 6) + 1
        ADD TEMP-NUM TO DAMAGE-TOTAL
        DISPLAY "Divine vengeance! Damage: " DAMAGE-TOTAL
        SUBTRACT DAMAGE-TOTAL FROM PLAYER-HP
        IF PLAYER-HP < 0
            MOVE 0 TO PLAYER-HP
        END-IF
    ELSE
        DISPLAY "The divine strike fails!"
    END-IF.

COMPUTER-EVOCATION-SPECIAL.
    MOVE 0 TO DAMAGE-TOTAL
    PERFORM 3 TIMES
        PERFORM ROLL-DICE
        COMPUTE TEMP-NUM = FUNCTION MOD(DICE-ROLL, 4) + 1
        ADD TEMP-NUM TO DAMAGE-TOTAL
    END-PERFORM
    ADD 3 TO DAMAGE-TOTAL
    DISPLAY "Magic Missile! Damage: " DAMAGE-TOTAL
    SUBTRACT DAMAGE-TOTAL FROM PLAYER-HP
    IF PLAYER